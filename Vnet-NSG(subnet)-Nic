---
- hosts: localhost
  vars: 
    rgname: "rg1"
  tasks:
   - name: Create a resource group
     azure_rm_resourcegroup:
      name: "{{rgname}}"
      location: "eastus"
   - name: Create virtual network vnet1
     azure_rm_virtualnetwork:
      resource_group: "{{rgname}}"
      name: "h1Vnet"
      location: "eastus"
      address_prefixes: "10.1.0.0/16"
   - name: Create Network Security Group that RDP
     azure_rm_securitygroup:
       resource_group: "{{ rgname}}"
       name: "h1NSG"
       location: "eastus"
       rules:
        - name: RDP
          protocol: Tcp
          destination_port_range: 3389
          access: Allow
          priority: 1001
          direction: Inbound  
   - name: Add subnet 
     azure_rm_subnet:
       resource_group: "{{rgname}}"
       name: "defaultsubnet"
       address_prefix: "10.1.0.0/24"
       virtual_network: "h1Vnet"
       security_group: "h1NSG"         
   - name: Create virtual network inteface card
     azure_rm_networkinterface:
      resource_group: "{{ rgname }}"
      name: "h1nic"
      location: "eastus"
      virtual_network: "h1Vnet"
      subnet: "defaultsubnet"
      create_with_security_group: "no"     
...      
